# ==================== CHANNEL SERVICE ====================
#
# ENVIRONMENT MODES:
# ┌──────────────────────────────────────────────────────────────────────────┐
# │  MODE              │ SERVICE_URL PATTERN         │ DATABASE HOST         │
# ├──────────────────────────────────────────────────────────────────────────┤
# │  Local Dev (npm)   │ http://localhost:PORT       │ localhost:5432        │
# │  Docker Compose    │ http://service-name:PORT    │ postgres:5432         │
# │  Docker Swarm      │ http://service-name:PORT    │ postgres:5432         │
# └──────────────────────────────────────────────────────────────────────────┘
#
# This service handles:
# - WhatsApp webhook (receive messages)
# - Message storage (FIFO 30 messages per user)
# - Internal API for sending messages
# - Chat history API for AI context
# ============================================================================

# Node Environment
NODE_ENV=development
PORT=3001

# Database (Channel Service)
# Local Dev: localhost:5432
# Docker: infra-postgres:5432
DATABASE_URL=postgresql://postgres:genfity2025@infra-postgres:5432/gc_channel

# RabbitMQ
# Local Dev: localhost:5672
# Docker: rabbitmq:5672
RABBITMQ_URL=amqp://admin:genfityrabbitmq@rabbitmq:5672/govconnect

# Internal API Key (untuk auth antar service)
INTERNAL_API_KEY=govconnect-internal-2025-secret

# WhatsApp API (clivy-wa-support/genfity-wa)
# WA_API_URL is the base URL of WhatsApp gateway (harus include prefix `/wa`)
# Direkomendasikan: pakai public gateway (genfity-wa-support).
WA_API_URL=https://api-wa.genfity.com/wa

# (Opsional) Buat sesi via genfity-app customer-api (API key auth).
GENFITY_APP_API_URL=https://genfity.com/api/customer-api
GENFITY_APP_CUSTOMER_API_KEY=gf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Token fallback (opsional). Normalnya token sesi disimpan otomatis di DB internal.
WA_ACCESS_TOKEN=

# Verify token untuk webhook (opsional). Jika kosong, Channel Service akan menerima verifikasi tanpa token.
WA_WEBHOOK_VERIFY_TOKEN=

# Jika true, Channel Service tidak akan mengirim request keluar ke WhatsApp provider
WA_DRY_RUN=false

# Default village (single desa/kelurahan untuk saat ini)
DEFAULT_VILLAGE_ID=

# Public base URLs (untuk build webhook URL)
PUBLIC_BASE_URL=http://localhost:3000
PUBLIC_CHANNEL_BASE_URL=http://localhost:3001

# Message Batching
# Batch messages from same user to reduce AI calls
MESSAGE_BATCH_DELAY_MS=2000
MAX_BATCH_SIZE=10

# Logging
LOG_LEVEL=debug
LOG_DIR=logs

# ==================== MEDIA / UPLOADS ====================
# MEDIA_STORAGE_PATH: lokasi penyimpanan file di container
# MEDIA_INTERNAL_URL: base URL untuk akses media dari internal Docker network
# MEDIA_PUBLIC_URL: base URL yang bisa diakses publik (dipakai untuk URL yang dikirim ke user)
MEDIA_STORAGE_PATH=/app/uploads
MEDIA_INTERNAL_URL=http://channel-service:3001/uploads
MEDIA_PUBLIC_URL=http://localhost:3001/uploads

# ==================== INTERNAL SERVICE URLS ====================
# These are for internal service-to-service communication
# In Docker (Compose/Swarm): Use container names
# In Local Dev: Use localhost with respective ports
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │  LOCAL DEVELOPMENT (npm run dev)                                            │
# │  ─────────────────────────────────────────────────────────────────────────  │
# │  CASE_SERVICE_URL=http://localhost:3003                                     │
# │  NOTIFICATION_SERVICE_URL=http://localhost:3004                             │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │  DOCKER (Compose/Swarm) - Uses internal Docker network                      │
# │  ─────────────────────────────────────────────────────────────────────────  │
# │  CASE_SERVICE_URL=http://case-service:3003                                  │
# │  NOTIFICATION_SERVICE_URL=http://notification-service:3004                  │
# └─────────────────────────────────────────────────────────────────────────────┘
#
CASE_SERVICE_URL=http://localhost:3003
NOTIFICATION_SERVICE_URL=http://localhost:3004

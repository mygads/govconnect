generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ChannelType {
  WHATSAPP
  WEBCHAT
}

model NotificationLog {
  id                 String      @id @default(cuid())
  channel            ChannelType @default(WHATSAPP)
  channel_identifier String      // WA: 628xxx | Webchat: session_id
  wa_user_id         String?     // Legacy, deprecated - use channel_identifier
  message_text       String      @db.Text
  notification_type  String      // "ai_reply" | "complaint_created" | "service_requested" | "status_updated" | "urgent_alert"
  status             String      // "sent" | "failed" | "skipped"
  error_msg          String?     @db.Text
  sent_at            DateTime    @default(now())
  
  @@index([channel, channel_identifier])
  @@index([wa_user_id])
  @@index([status])
  @@index([notification_type])
  @@index([sent_at])
  @@map("notification_logs")
}

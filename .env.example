# ===================================================================================
# GOVCONNECT - ENVIRONMENT CONFIGURATION
# ===================================================================================
#
# USAGE:
#   cp .env.example .env
#   # Edit values according to your environment
#
# DOCKER COMPOSE FILES:
#   - docker-compose.yml        = Local development (builds from source)
#   - docker-compose.swarm.yml  = Production on server (uses GHCR images)
#
# ARCHITECTURE NOTE:
# ┌───────────────────────────────────────────────────────────────────────────────┐
# │  DIRECT SERVICE COMMUNICATION (NO AGGREGATED GATEWAY)                          │
# │                                                                               │
# │  Dashboard/AI/Channel/Case/Notification saling berkomunikasi langsung           │
# │  via URL service masing-masing (internal Docker network).                      │
# │                                                                               │
# │  INTERNAL ACCESS:                                                              │
# │  http://channel-service:3001                                                   │
# │  http://ai-service:3002                                                        │
# │  http://case-service:3003                                                      │
# │  http://notification-service:3004                                              │
# └───────────────────────────────────────────────────────────────────────────────┘
#
# ===================================================================================

# ==================== ENVIRONMENT ====================
NODE_ENV=production
LOG_LEVEL=info

# ==================== DATABASE (PostgreSQL) ====================
# Database is in containers/database/ (external)
# Each service uses separate database: gc_channel, gc_ai, gc_case, gc_notification, gc_dashboard
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_postgres_password
POSTGRES_HOST=infra-postgres
POSTGRES_PORT=5432

# ==================== RABBITMQ ====================
# RabbitMQ is in containers/supporting/ (external)
RABBITMQ_USER=admin
RABBITMQ_PASSWORD=your_rabbitmq_password
RABBITMQ_HOST=infra-rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_MANAGEMENT_URL=http://infra-rabbitmq:15672

# ==================== SECURITY ====================
# Generate secrets: openssl rand -base64 32
INTERNAL_API_KEY=your_internal_api_key
JWT_SECRET=your_jwt_secret

# ==================== WHATSAPP API ====================
# WhatsApp API is in containers/whatsapp-api/ (external)
WA_API_URL=http://wa-api:8080/wa
# Token fallback (opsional). Umumnya token sesi disimpan otomatis di DB internal.
WA_ACCESS_TOKEN=
WA_WEBHOOK_VERIFY_TOKEN=your_webhook_verify_token

# ==================== TESTING MODE ====================
# Enable testing mode to skip WhatsApp API calls (true/false)
# When enabled: messages processed but not sent to WhatsApp
TESTING_MODE=false

# ==================== AI / LLM ====================
# Get key from: https://aistudio.google.com/apikey
GEMINI_API_KEY=your_gemini_api_key
LLM_MODEL_PRIMARY=gemini-2.0-flash
LLM_MODEL_FALLBACK=gemini-2.0-flash-lite
LLM_TEMPERATURE=0.3
LLM_MAX_TOKENS=3000
LLM_TIMEOUT_MS=30000
MAX_HISTORY_MESSAGES=30

# ==================== 2-LAYER LLM ARCHITECTURE ====================
# Enable 2-Layer LLM Architecture (true/false)
# Layer 1: Intent & Understanding (small, cheap models like gemini-2.0-flash-lite)
# Layer 2: Response Generation (larger, better models like gemini-2.5-flash)
# Benefits: 60% cost reduction + 15-20% better accuracy
USE_2_LAYER_ARCHITECTURE=true

# Override model list untuk 2-layer (comma-separated)
# Layer 1 (murah/cepat): intent + ekstraksi
LAYER1_MODELS=gemini-2.0-flash-lite,gemini-2.5-flash-lite,gemini-2.0-flash
# Layer 2 (kualitas): generasi jawaban natural
LAYER2_MODELS=gemini-2.5-flash,gemini-2.0-flash,gemini-2.5-flash-lite

# ==================== MESSAGE BATCHING ====================
# Batch messages from same user to reduce AI calls
MESSAGE_BATCH_DELAY_MS=2000
MAX_BATCH_SIZE=10
USE_ADAPTIVE_BATCHING=true

# Webchat batching (AI service)
WEBCHAT_BATCH_DELAY_MS=2000
WEBCHAT_MAX_BATCH_SIZE=10

# ==================== RATE LIMITING ====================
RATE_LIMIT_ENABLED=true
MAX_REPORTS_PER_DAY=5
COOLDOWN_SECONDS=30
AUTO_BLACKLIST_VIOLATIONS=10

# ==================== URLS ====================
MEDIA_PUBLIC_URL=https://channel.govconnect.my.id/uploads
# Internal base URL untuk akses media via jaringan docker (dipakai antar-service)
MEDIA_INTERNAL_URL=http://channel-service:3001/uploads
# Path storage file di container Channel Service
MEDIA_STORAGE_PATH=/app/uploads
NEXTAUTH_URL=https://dashboard.govconnect.my.id
# Dashboard URL (untuk link alert urgent di Notification Service)
DASHBOARD_URL=https://dashboard.govconnect.my.id

# Public base URL untuk webhook/preview channel
PUBLIC_BASE_URL=https://govconnect.my.id
PUBLIC_CHANNEL_BASE_URL=https://channel.govconnect.my.id

# Default village context (AI & public form)
DEFAULT_VILLAGE_ID=
DEFAULT_VILLAGE_SLUG=desa
PUBLIC_FORM_BASE_URL=https://govconnect.my.id

# ==================== CASE SERVICE ====================
ID_PREFIX_COMPLAINT=LAP
ID_PREFIX_SERVICE_REQUEST=LAY

# ==================== NOTIFICATION ====================
ADMIN_WHATSAPP=

# ==================== LOGGING ====================
LOG_DIR=logs

# ==================== SEO & ANALYTICS ====================
# App URL untuk SEO (gunakan domain production)
NEXT_PUBLIC_APP_URL=https://govconnect.my.id

# Google Tag Manager
# Dapatkan dari: https://tagmanager.google.com
NEXT_PUBLIC_GTM_ID=GTM-MXDV48SG

# Google Analytics 4 (opsional)
# Dapatkan dari: https://analytics.google.com → Admin → Data Streams → Web
# NEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX

# Google Search Console Verification
# Dapatkan dari: https://search.google.com/search-console
NEXT_PUBLIC_GOOGLE_VERIFICATION=RDCMbbVmAgibeAL-LxyEZkEZXHRhXCsGkWUnw7q5cdk

# Bing Webmaster Tools (opsional)
# NEXT_PUBLIC_BING_VERIFICATION=YOUR_BING_CODE

# ==================== KNOWLEDGE/RAG ====================
USE_RAG_SEARCH=true

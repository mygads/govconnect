# ==================== AI ORCHESTRATOR SERVICE ====================
#
# ENVIRONMENT MODES:
# ┌──────────────────────────────────────────────────────────────────────────┐
# │  MODE              │ SERVICE_URL PATTERN         │ RABBITMQ HOST         │
# ├──────────────────────────────────────────────────────────────────────────┤
# │  Local Dev (npm)   │ http://localhost:PORT       │ localhost:5672        │
# │  Docker Compose    │ http://service-name:PORT    │ rabbitmq:5672         │
# │  Docker Swarm      │ http://service-name:PORT    │ rabbitmq:5672         │
# └──────────────────────────────────────────────────────────────────────────┘
#
# IMPORTANT: This service is STATELESS (no database) and communicates via:
# - RabbitMQ: Consume incoming messages, publish AI replies
# - REST: Sync calls to Channel/Case services for data
# ============================================================================

# Environment
NODE_ENV=development
PORT=3002

# Google Gemini API
GEMINI_API_KEY=your_gemini_api_key_here

# ==================== DATABASE ====================
# PostgreSQL with pgvector extension for AI Service
# Uses separate database gc_ai (no schema needed, uses public by default)
# Local Dev: localhost:5432 (mapped port)
# Docker: infra-postgres:5432
DATABASE_URL=postgresql://postgres:genfity2025@infra-postgres:5432/gc_ai

# RabbitMQ
# Local Dev: localhost:5672
# Docker: infra-rabbitmq:5672
RABBITMQ_URL=amqp://admin:genfityrabbitmq@infra-rabbitmq:5672/govconnect

# ==================== INTERNAL SERVICE URLS ====================
# These are for internal service-to-service communication
# In Docker (Compose/Swarm): Use container names (channel-service, case-service)
# In Local Dev: Use localhost with respective ports
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │  LOCAL DEVELOPMENT (npm run dev)                                            │
# │  ─────────────────────────────────────────────────────────────────────────  │
# │  CHANNEL_SERVICE_URL=http://localhost:3001                                  │
# │  CASE_SERVICE_URL=http://localhost:3003                                     │
# │  DASHBOARD_SERVICE_URL=http://localhost:3000                                │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │  DOCKER (Compose/Swarm) - Uses internal Docker network                      │
# │  ─────────────────────────────────────────────────────────────────────────  │
# │  CHANNEL_SERVICE_URL=http://channel-service:3001                            │
# │  CASE_SERVICE_URL=http://case-service:3003                                  │
# │  DASHBOARD_SERVICE_URL=http://dashboard:3000                                │
# └─────────────────────────────────────────────────────────────────────────────┘
#
CHANNEL_SERVICE_URL=http://channel-service:3001
CASE_SERVICE_URL=http://case-service:3003
DASHBOARD_SERVICE_URL=http://dashboard:3000

# Internal API Key (shared secret for inter-service authentication)
# All services must use the same key for internal calls
INTERNAL_API_KEY=govconnect-internal-2025-secret

# Logging
LOG_LEVEL=debug
LOG_DIR=logs

# LLM Configuration
# Note: Konfigurasi model AI hanya melalui ENV (tidak ada pengaturan di dashboard)
LLM_TEMPERATURE=0.3
LLM_MAX_TOKENS=2000
LLM_TIMEOUT_MS=30000

# ==================== 2-LAYER LLM ARCHITECTURE ====================
# Enable 2-Layer LLM Architecture (true/false)
# This setting controls BOTH WhatsApp AND Webchat channels
# 
# Layer 1: Intent & Understanding (small, cheap models: gemini-2.0-flash-lite)
# Layer 2: Response Generation (larger, better models: gemini-2.5-flash)
# 
# Benefits: 60% cost reduction + 15-20% better accuracy
# 
# When true:  Both WhatsApp and Webchat use 2-Layer architecture
# When false: Both channels use Single-Layer architecture
USE_2_LAYER_ARCHITECTURE=true

# ==================== TESTING MODE ====================
# Enable testing mode to skip WhatsApp API calls (true/false)
# When enabled: messages processed but not sent to WhatsApp
# Useful for development and testing without affecting real users
TESTING_MODE=false

# Context Configuration
MAX_HISTORY_MESSAGES=30

# Default village context (used for knowledge & complaint mapping)
DEFAULT_VILLAGE_ID=
DEFAULT_VILLAGE_SLUG=desa
PUBLIC_FORM_BASE_URL=https://govconnect.my.id

# ==================== RATE LIMITING ====================
# Enable/disable rate limiting (true/false)
RATE_LIMIT_ENABLED=true
# Maximum reports per day per user
MAX_REPORTS_PER_DAY=5
# Cooldown between reports in seconds
COOLDOWN_SECONDS=30
# Auto-blacklist after N violations
AUTO_BLACKLIST_VIOLATIONS=10
